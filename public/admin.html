<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script defer>
        async function getUsers() {
            const users = await fetch("/brukere");
            const userData = await users.json();

            console.log(userData);

            for (let user of userData) {
                const userTable = document.getElementById("userTable");

                const tr = document.createElement("tr");     
                tr.id = "row" + user.id;         
                
                const tdId = document.createElement("td");
                tdId.innerText = user.id;

                const tdFornavn = document.createElement("td");
                tdFornavn.innerText = user.fornavn;

                const tdEtternavn = document.createElement("td");
                tdEtternavn.innerText = user.etternavn;

                const tdFodselsdato = document.createElement("td");
                tdFodselsdato.innerText = user.fdato;

                const tdEpost = document.createElement("td");
                tdEpost.innerText = user.epost;

                const tdBrukernavn = document.createElement("td");
                tdBrukernavn.innerText = user.brukernavn;

                const tdPassord = document.createElement("td");
                tdPassord.innerText = user.passord;

                const tdUpdate = document.createElement("td");
                const updateButton = document.createElement("button");
                updateButton.innerText = "Endre bruker";
                updateButton.addEventListener("click", () => {
                    let row = document.getElementById("row" + user.id);                    

                    let fornavnTd = row.children[1];
                    fornavnTd.innerHTML = `<input type="text" form="form${user.id}" value="${user.fornavn}">`;

                    let etternavnTd = row.children[2];
                    etternavnTd.innerHTML = `<input type="text" form="form${user.id}"  value="${user.etternavn}">`;

                    let fdatoTd = row.children[3];
                    fdatoTd.innerHTML = `<input type="text" form="form${user.id}"  value="${user.fdato}">`;

                    let epostTd = row.children[4];
                    epostTd.innerHTML = `<input type="text" form="form${user.id}"  value="${user.epost}">`;

                    let brukernavnTd = row.children[5];
                    brukernavnTd.innerHTML = `<input type="text" form="form${user.id}" value="${user.brukernavn}">`;

                    let updateButtonTd = row.children[7];
                    updateButtonTd.innerHTML = `
                    <form action="/oppdatere" method="POST" name="${user.id}" id="form${user.id}">
                        <input type="hidden" name="id" value="${user.id}">
                        <input type="submit" value="Lagre">
                    </form>
                    `

        
                });
                tdUpdate.appendChild(updateButton);

                tr.appendChild(tdId);
                tr.appendChild(tdFornavn);
                tr.appendChild(tdEtternavn);
                tr.appendChild(tdFodselsdato);
                tr.appendChild(tdEpost);
                tr.appendChild(tdBrukernavn);
                tr.appendChild(tdPassord);
                tr.appendChild(tdUpdate);

                userTable.appendChild(tr);
            }
        }

        getUsers();
    </script>
</head>
<body>
    <table id="userTable">
        <tr>
            <th>Id</th>
            <th>Fornavn</th>
            <th>Etternavn</th>
            <th>FÃ¸dselsdato</th>
            <th>Epost</th>
            <th>Brukernavn</th>
            <th>Passord</th>
        </tr>
        
    </table>
</body>
</html>